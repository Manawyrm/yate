# Makefile
# This file holds the make rules for the libyatess7

DEBUG :=

CXX  := @CXX@ -Wall
AR  := ar
DEFS :=
LIBTHR := -lpthread
INCLUDES := -I@top_srcdir@ -I../.. -I@srcdir@
CFLAGS := -O2 @MODULE_CPPFLAGS@ @INLINE_FLAGS@
LDFLAGS:= -L../.. -lyate
INCFILES := @top_srcdir@/yateclass.h @srcdir@/yatess7.h

PROGS= yate-ss7test
LIBS = libyatess7.a
OBJS = engine.o address.o sigcall.o sigtran.o \
	interface.o layer2.o layer3.o \
	router.o sccp.o tcap.o \
	q921.o q931.o
DOCS = classes.png

LOCALFLAGS =
LOCALLIBS =
COMPILE = $(CXX) $(DEFS) $(DEBUG) $(INCLUDES) $(CFLAGS)
LINK = $(CC) $(LDFLAGS)

prefix = @prefix@
exec_prefix = @exec_prefix@

# include optional local make rules
-include YateLocal.mak

.PHONY: all debug ddebug xdebug docs
all: $(LIBS) $(PROGS)

docs: $(DOCS)

debug:
	$(MAKE) all DEBUG=-g3 MODSTRIP=

ddebug:
	$(MAKE) all DEBUG='-g3 -DDEBUG' MODSTRIP=

xdebug:
	$(MAKE) all DEBUG='-g3 -DXDEBUG' MODSTRIP=

.PHONY: strip
strip: all
	strip --strip-debug --discard-locals $(PROGS)

.PHONY: clean
clean:
	@-$(RM) $(PROGS) $(LIBS) $(OBJS) core 2>/dev/null

%.o: @srcdir@/%.cpp $(INCFILES)
	$(COMPILE) -c $<

Makefile: @srcdir@/Makefile.in ../../config.status
	cd ../.. && ./config.status

yate-%: @srcdir@/main-%.cpp $(MKDEPS) libyatess7.a ../../libyate.so $(INCFILES)
	$(COMPILE) -o $@ $(LOCALFLAGS) $< $(LIBTHR) $(LDFLAGS) $(LOCALLIBS)

libyatess7.a: $(OBJS)
	$(AR) rcs $@ $^

yate-ss7test: LOCALLIBS += -L. -lyatess7

%.png: @srcdir@/%.dia
	dia --export-to-format=png --export=$@ $<
